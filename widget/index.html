<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>赞友生活</title>
    <link rel="stylesheet" type="text/css" href="./css/api.css" />
    <link rel="stylesheet" type="text/css" href="./css/aui.css" />
    <link rel="stylesheet" type="text/css" href="./css/common.css" />
    <link rel="stylesheet" type="text/css" href="./css/swiper.css" />
    <style type="text/css">
        html,body{
            height: 100%;
            width: 100%;
        }
        body {
            background-size: 100% 100%;
            background-position: bottom center;
            position: absolute;
            background-image: url(./image/ucenter.png);
        }
        #main {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            flex: 1;
        }
        .aui-searchbar {
            background: transparent;
        }
        .aui-bar-nav .aui-searchbar-input {
            background-color: #ffffff;
        }
        .headdisplay {
            display: none;
        }
        .active {
            display: block;
        }
        .dot {
            font-size: 1.0rem;
        }
        .header-drop-menu {
            position: relative;
            display: block;
            float: right;
            color: white;
            padding-left: 5px;
            padding-right: 5px;
            z-index: 1000;
        }
        .vertical-middle {
            display: -webkit-box;
            -webkit-box-orient: horizontal;
            -webkit-box-align: center;
            display: box;
            box-orient: horizontal;
            box-align: center;
        }
        .header-span2 {
            position: relative;
            display: block;
            float: right;
            color: white;
            padding-left: 5px;
            padding-right: 5px;
            z-index: 1000;
        }
        .header-span2-i {
            font-size: 1.5rem;
        }
        .swiper-container {
            margin-left: 0px;
            margin-right: 5px;
            position: relative;
            overflow: hidden;
            color: #333;
            font-size: 15px;
            width: 70px;
            /* Fix of Webkit flickering */
        }
    </style>
</head>

<body>
    <!--头部-->
    <div id="wrap" class="aui-bar-nav aui-bar-header">
        <header class="aui-bar aui-bar-header headdisplay active" id="aui-header">
            <!--    <a class="aui-pull-left aui-btn">
                <img src="./image/sysimg.png" style="width:1.5rem;">
            </a>-->
            <a class="aui-pull-left" tapmode data-title="扫一扫" onclick="openScanner()">
                <span class="aui-iconfont aui-icon-scanner" style="font-size:22px"></span></a>
            <div class="aui-title" style="left:1.5rem; right: 1.5rem;">
                <div class="aui-searchbar" id="search">
                    <div class="aui-searchbar-input aui-border-radius">
                        <i class="aui-iconfont aui-icon-search"></i>
                        <div type="search" id="search-title" tapmode onclick="loadWin('搜索','search_win','./html/taobao/search_win.html')">复制宝贝标题搜索，热搜:</div>
                        <div class="swiper-container" id="swiper">
                            <div class="swiper-wrapper" id="words_li">
                                <div class="swiper-slide" tapmode data-words="女装" onclick="search(this)">女装</div>
                                <div class="swiper-slide" tapmode data-words="男装" onclick="search(this)">男装</div>
                                <div class="swiper-slide" tapmode data-words="女鞋" onclick="search(this)">女鞋</div>
                                <div class="swiper-slide" tapmode data-words="男鞋" onclick="search(this)">男鞋</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <a class="aui-pull-right" tapmode data-url="../user/touch.html" data-title="客服中心" onclick="openWin(this)">
                <span class="iconfont icon-wx" style="font-size:22px"></span></a>
        </header>
        <header class="aui-bar aui-bar-header headdisplay" id="collect-header">
            <a class="aui-pull-left" tapmode> <span class="aui-iconfont aui-icon-"></span> </a>
            <div class="fq-column-title am-text-center">
                <span>视 频 单</span>
                <span class="fq-title-blue"></span>
                <span class="fq-title-yellow"></span>
            </div>
            <a class="aui-pull-right" tapmode> <span class="aui-iconfont aui-icon-"></span></a>
        </header>
        <header class="aui-bar aui-bar-header headdisplay" id="fenlei-header">
            <a class="aui-pull-left" tapmode> <span class="aui-iconfont aui-icon-"></span> </a>
            <div class="aui-title">
                超级分类
            </div>
            <a class="aui-pull-right" tapmode onclick="loadWin('搜索','search_win','./html/taobao/search_win.html')">全网搜<span class="aui-iconfont aui-icon-search"></span></a>
        </header>
        <header class="aui-bar aui-bar-header headdisplay" id="tool-header">
            <a class="aui-pull-left" tapmode> <span class="aui-iconfont aui-icon-"></span> </a>
            <div class="fq-column-title am-text-center">
                <span>热 榜</span>
                <span class="fq-title-blue"></span>
                <span class="fq-title-blueleft"></span>
                <span class="fq-title-plum"></span>
                <span class="fq-title-yellow"></span>
            </div>
            <span tapmode="" id="drop-menu" data-open="false" class="iconfont1 header-drop-menu vertical-middle "><i class="aui-iconfont aui-icon- dot vertical-middle" onclick=""></i></span>
            <span tapmode="" class="iconfont1 header-span2 vertical-middle"><i class="iconfont icon-gengduo1 header-span2-i vertical-middle" onclick=""></i></span>
        </header>
        <header class="aui-bar aui-bar-header headdisplay" id="my-header">
            <a class="aui-pull-left" tapmode onclick="loginopen('../../html/user/news.html','消息中心')"><span class="aui-iconfont aui-icon-note"></span> </a>
            <div class="aui-title">
                个人中心
            </div>
            <a class="aui-pull-right" tapmode data-url="../user/set.html" data-title="系统设置" onclick="openWin(this)"><span class="iconfont icon-shezhi"></span> </a>
        </header>
    </div>
    <!--中部-->
    <div id="main"></div>
    <!--底部-->
    <footer class="aui-bar aui-bar-tab aui-border-t" id="footer">
        <div class="aui-bar-tab-item active" tapmode>
            <i class="iconfont icon-home"></i>
            <div class="aui-bar-tab-label">
                首页
            </div>
        </div>
        <div class="aui-bar-tab-item" tapmode>
            <i class="iconfont icon-shipin"></i>
            <div class="aui-bar-tab-label">
                看货
            </div>
        </div>
        <div class="aui-bar-tab-item" tapmode>
            <i class="iconfont icon-fenlei"></i>
            <div class="aui-bar-tab-label">
                分类
            </div>
        </div>
        <div class="aui-bar-tab-item" tapmode>
            <i class="iconfont icon-xiaoliang"></i>
            <div class="aui-bar-tab-label">
                热榜
            </div>
        </div>
        <div class="aui-bar-tab-item" tapmode>
            <i class="iconfont icon-gerenzhongxin"></i>
            <div class="aui-bar-tab-label">
                我的
            </div>
        </div>
    </footer>
</body>
<script type="text/javascript" src="./script/jquery.js"></script>
<script type="text/javascript" src="./script/api.js"></script>
<script type="text/javascript" src="./script/public.js"></script>
<script type="text/javascript" src="./script/aui-tab.js"></script>
<script type="text/javascript" src="./script/common.js"></script>
<script type="text/javascript" src="./script/swiper.js"></script>
<script type="text/javascript" src="./script/md5.js"></script>
<script type="text/javascript">
    var headerPos, main, mainPos, footerPos, footer,
        main = 0,
        tools = 0,
        ucenter = 0,
        fenlei = 0,
        collect = 0;
    var ajpush = null;
    apiready = function() {
        api.parseTapmode();
        //  if (!confirmPer('storage')) {
        //    console.log('获取存储权限');
        //  return false;
        //  }
        HasPermission();
        api.setStatusBarStyle({
            style: 'dark'
        });
        header = $api.byId('wrap');
        footer = $api.byId('footer');
        $api.fixIos7Bar(header); //适配IOS 7+，Android 4.4+状态栏
        $api.fixTabBar(footer); //适配IOS X 底部
        headerPos = $api.offset(header);
        footerPos = $api.offset(footer);
        var backSecond = 0;
        api.addEventListener({ //监听返回键
            name: 'keyback'
        }, function(ret, err) {
            api.closeSlidPane();
            var curSecond = new Date().getSeconds();
            if (Math.abs(curSecond - backSecond) > 2) {
                backSecond = curSecond;
                Toast('再按一次退出' + api.appName);
            } else {
                api.closeWidget({
                    id: api.appId,
                    silent: true
                });
                var isAndroid = (/android/gi).test(navigator.appVersion);
                if (isAndroid) {
                    api.toLauncher();
                }
            }
        });
        config(); //加载参数配置
        indexGuide(); //启动画面
    }

    //启动画面
    function indexGuide() {
        var timestamp = Date.parse(new Date()) / 1e3; //当前时间戳 精确到秒
        if (GetStorage('firsttime') && GetStorage('firsttime') > timestamp) {
            startAdvert();
        } else {
            removelv();
            api.openFrameGroup({
                name: 'guide',
                background: '#000',
                scrollEnabled: true,
                rect: {
                    x: 0,
                    y: 0,
                    w: 'auto',
                    h: 'auto'
                },
                index: 0,
                frames: [{
                    name: 'guide1',
                    url: './html/guide/guide1.html',
                    pageParam: {},
                    bounces: false,
                    opaque: true,
                    bgColor: 'widget://image/guide/guide1.png'
                }, {
                    name: 'guide2',
                    url: './html/guide/guide2.html',
                    pageParam: {},
                    bounces: false,
                    opaque: true,
                }, {
                    name: 'guide3',
                    url: './html/guide/guide3.html',
                    pageParam: {},
                    bounces: false,
                    opaque: true,
                }, {
                    name: 'guide4',
                    url: './html/guide/guide4.html',
                    pageParam: {},
                    bounces: false,
                    opaque: true,
                }]
            }, function(ret, err) {
                var name = ret.name;
                var index = ret.index;
                SetStorage('firsttime', timestamp + 1296000);
            });
        }
    };
    //插屏广告
    function startAdvert() {
        var connectionType = api.connectionType; //全局变量
        var picurl = GetStorage('picurl'); //'http://img.alicdn.com/imgextra/i4/3953973096/O1CN013JMnCR1Yk0idwaQyO_!!3953973096.jpg_600x600.jpg';//
        if (picurl && picurl != 'undefined' && connectionType != 'none') {
            console.log('启动插屏广告，' + picurl);
            setTimeout(removelv, 10);
            openwin_launch(picurl);
            setTimeout(setstartlogo, 8000);
        } else {
            setTimeout(removelv, 3000);
            indexfirst();
            setTimeout(setstartlogo, 8000);
        }
    }
    //进入主页
    function indexfirst() {
        api.closeWin({
            name: 'startadvert',
            animation: {
                type: "none", //动画类型（详见动画类型常量）
                duration: 100 //动画过渡时间，默认300毫秒
            }
        });
        api.setFrameGroupAttr({
            name: 'guide',
            hidden: true
        });

        api.openFrame({
            name: 'frame1_win',
            url: './html/frame/frame1_win.html',
            vScrollBarEnabled: false,
            bounces: false,
            rect: {
                x: 0,
                y: headerPos.h,
                w: 'auto',
                h: 'auto', //api.winHeight - footerPos.h - headerPos.h
                marginBottom: footerPos.h,
            },
            pageParam: {
                headerPos: headerPos,
                footerPos: footerPos
            },
        });

        main = 1;
        api.sendFrameToBack({
            from: 'frame1_win',
        });

        setTimeout(keyword, 3000); //今日热搜关键词
        setTimeout(discount, 12000); //弹窗
        setTimeout(pushInit, 5000); //初始化极光推送
        setTimeout(getcopy, 4000); //获取剪切板内容
        setTimeout(setcopy, 8000); //监听剪切板内容
        setTimeout(shorturl, 7000); //短链链接转换
        if (!GetStorage('updatetimes') || GetStorage('updatetimes') < timestamp) {
            var datetime = GetDatetime('Y-m-d H:i:s', timestamp)
            setTimeout(autoupdate, 10000); //自动更新检测
            SetStorage('updatetimes', timestamp + 43200);
        }
    }
    //打开弹窗
    function discount() {
        console.log('打开弹窗');
        api.openFrame({
            name: 'discountalert',
            url: './html/alert/discountalert.html',
            vScrollBarEnabled: false,
            bgColor: 'rgba(0,0,0,0.0)',
            bounces: false,
            rect: {
                x: 0,
                y: 150,
                w: api.winWidth / 1.85,
                h: 30
            },
        });
    }
    //底部随意切换
    var tab = new auiTab({
        element: document.getElementById("footer"),
        index: 1
    }, function(ret) {
        if (ret) {
            if (ret.index == 1) {
                showtab1();
            } else
            if (ret.index == 2) {
                showtab2();
            } else
            if (ret.index == 3) {
                showtab3();
            } else
            if (ret.index == 4) {
                showtab4();
            } else
            if (ret.index == 5) {
                showtab5();
            }
        }
    });

    //首页
    function showtab1() {
        tab.setActive(1);
        var heade = $api.dom('#wrap .active');
        $api.removeCls(heade, 'active');
        var thisHeader = $api.dom('#aui-header');
        $api.addCls(thisHeader, 'active');
        if (main != 0) {
            api.setFrameAttr({
                name: 'frame1_win',
                hidden: false
            });
            api.setFrameGroupAttr({
                name: 'frame1_frm',
                hidden: false
            });
        } else {
            api.openFrame({
                name: 'frame1_win',
                url: './html/frame/frame1_win.html',
                vScrollBarEnabled: false,
                bounces: false,
                rect: {
                    x: 0,
                    y: headerPos.h,
                    w: 'auto',
                    h: 'auto', //api.winHeight - footerPos.h - headerPos.h
                    marginBottom: footerPos.h
                },
                pageParam: {
                    headerPos: headerPos,
                    footerPos: footerPos
                },
            });
            main = 1;
        }
        api.setFrameAttr({
            name: 'frame2_win',
            hidden: true
        });
        api.setFrameGroupAttr({
            name: 'frame2_frm',
            hidden: true
        });
        api.setFrameAttr({
            name: 'frame3',
            hidden: true
        });
        api.setFrameAttr({
            name: 'frame4_win',
            hidden: true
        });
        api.setFrameGroupAttr({
            name: 'frame4_frm',
            hidden: true
        });
        api.setFrameAttr({
            name: 'frame5',
            hidden: true
        });
    }
    //第二页
    function showtab2() {
        tab.setActive(2);
        var heade = $api.dom('#wrap .active');
        $api.removeCls(heade, 'active');
        var thisHeader = $api.dom('#collect-header');
        $api.addCls(thisHeader, 'active');
        if (collect != 0) {
            api.setFrameAttr({
                name: 'frame2_win',
                hidden: false
            });
            api.setFrameGroupAttr({
                name: 'frame2_frm',
                hidden: false
            });
        } else {
            api.openFrame({
                name: 'frame2_win',
                url: './html/frame/frame2_win.html',
                vScrollBarEnabled: false,
                bounces: false,
                rect: {
                    x: 0,
                    y: headerPos.h,
                    w: 'auto',
                    h: 'auto', //api.winHeight - footerPos.h - headerPos.h
                    marginBottom: footerPos.h
                },
                pageParam: {
                    headerPos: headerPos,
                    footerPos: footerPos
                },
            });
            collect = 1;
        }
        api.setFrameAttr({
            name: 'frame1_win',
            hidden: true
        });
        api.setFrameGroupAttr({
            name: 'frame1_frm',
            hidden: true
        });
        api.setFrameAttr({
            name: 'frame3',
            hidden: true
        });
        api.setFrameAttr({
            name: 'frame4_win',
            hidden: true
        });
        api.setFrameGroupAttr({
            name: 'frame4_frm',
            hidden: true
        });
        api.setFrameAttr({
            name: 'frame5',
            hidden: true
        });
    }
    //超级分类
    function showtab3() {
        tab.setActive(3);
        var heade = $api.dom('#wrap .active');
        $api.removeCls(heade, 'active');
        var thisHeader = $api.dom('#fenlei-header');
        $api.addCls(thisHeader, 'active');
        if (fenlei != 0) {
            api.setFrameAttr({
                name: 'frame3',
                hidden: false
            });
        } else {
            api.openFrame({
                name: 'frame3',
                url: './html/frame/frame3.html',
                vScrollBarEnabled: false,
                bounces: false,
                rect: {
                    x: 0,
                    y: headerPos.h,
                    w: 'auto',
                    h: 'auto', //api.winHeight - footerPos.h - headerPos.h
                    marginBottom: footerPos.h
                },
                pageParam: {
                    headerPos: headerPos,
                    footerPos: footerPos
                },
            });
            fenlei = 1;
        }
        api.setFrameAttr({
            name: 'frame1_win',
            hidden: true
        });
        api.setFrameGroupAttr({
            name: 'frame1_frm',
            hidden: true
        });
        api.setFrameAttr({
            name: 'frame2_win',
            hidden: true
        });
        api.setFrameGroupAttr({
            name: 'frame2_frm',
            hidden: true
        });
        api.setFrameAttr({
            name: 'frame4_win',
            hidden: true
        });
        api.setFrameGroupAttr({
            name: 'frame4_frm',
            hidden: true
        });
        api.setFrameAttr({
            name: 'frame5',
            hidden: true
        });
    }
    //第四页
    function showtab4() {
        tab.setActive(4);
        var heade = $api.dom('#wrap .active');
        $api.removeCls(heade, 'active');
        var thisHeader = $api.dom('#tool-header');
        $api.addCls(thisHeader, 'active');
        if (tools != 0) {
            api.setFrameAttr({
                name: 'frame4_win',
                hidden: false
            });
            api.setFrameGroupAttr({
                name: 'frame4_frm',
                hidden: false
            });
        } else {
            api.openFrame({
                name: 'frame4_win',
                url: './html/frame/frame4_win.html',
                vScrollBarEnabled: false,
                bounces: false,
                rect: {
                    x: 0,
                    y: headerPos.h, //+ 80,
                    w: 'auto',
                    h: 'auto', //api.winHeight - footerPos.h - headerPos.h -100
                    marginBottom: footerPos.h
                },
                pageParam: {
                    headerPos: headerPos,
                    footerPos: footerPos
                },
            });
            tools = 1;
        }
        api.setFrameAttr({
            name: 'frame1_win',
            hidden: true
        });
        api.setFrameGroupAttr({
            name: 'frame1_frm',
            hidden: true
        });
        api.setFrameAttr({
            name: 'frame2_win',
            hidden: true
        });
        api.setFrameGroupAttr({
            name: 'frame2_frm',
            hidden: true
        });
        api.setFrameAttr({
            name: 'frame3',
            hidden: true
        });
        api.setFrameAttr({
            name: 'frame5',
            hidden: true
        });
    }
    //个人中心
    function showtab5() {
        tab.setActive(5);
        var heade = $api.dom('#wrap .active');
        $api.removeCls(heade, 'active');
        var thisHeader = $api.dom('#my-header');
        $api.addCls(thisHeader, 'active');
        if (ucenter != 0) {
            api.setFrameAttr({
                name: 'frame5',
                hidden: false
            });
        } else {
            api.openFrame({
                name: 'frame5',
                url: './html/frame/frame5.html',
                vScrollBarEnabled: false,
                bounces: false,
                rect: {
                    x: 0,
                    y: headerPos.h,
                    w: 'auto',
                    h: 'auto', //api.winHeight - footerPos.h - headerPos.h
                    marginBottom: footerPos.h
                },
                pageParam: {
                    headerPos: headerPos,
                    footerPos: footerPos
                },
            });
            ucenter = 1;
        }
        api.setFrameAttr({
            name: 'frame1_win',
            hidden: true
        });
        api.setFrameGroupAttr({
            name: 'frame1_frm',
            hidden: true
        });
        api.setFrameAttr({
            name: 'frame2_win',
            hidden: true
        });
        api.setFrameGroupAttr({
            name: 'frame2_frm',
            hidden: true
        });
        api.setFrameAttr({
            name: 'frame3',
            hidden: true
        });
        api.setFrameAttr({
            name: 'frame4_win',
            hidden: true
        });
        api.setFrameGroupAttr({
            name: 'frame4_frm',
            hidden: true
        });
    }

    //关键字轮播
    var swiper = new Swiper(document.getElementById("swiper"), {  
        speed: 1000,
        autoplay: 2000,
        direction: 'vertical',
        observer: true,
        observerParents: true,
        autoplayDisableOnInteraction: false
    });
    //关键词轮播
    function keyword() {
        var commissiondata = GetStorage('commissiondata');
        if (commissiondata && commissiondata != 'null' && commissiondata != 'undefined') {
            var haodanku = "http://v2.api.haodanku.com/hot_key/apikey/" + commissiondata.apikey; //好单库
            api.ajax({
                    url: haodanku, //商品API接口链接
                    encode: false,
                    method: 'get',
                    timeout: 10,
                    cache: 'true',
                    dataType: 'json',
                },
                function(ret, err) {
                    if (ret.data) {
                        var slide = document.getElementById('words_li');
                        var len = ret.data.length;
                        var curPageData = ret.data;
                        /*下面就是往容器里面插入数据的代码*/
                        var html = '';
                        for (var i = 0; i < len; i++) {
                            html += '<li class="swiper-slide" tapmode data-words="' + curPageData[i].keyword + '"onclick="search(this);">' + curPageData[i].keyword + '</li>';
                            $api.html(slide, html);
                        }
                    }
                });
        }
    }
    //初始化推送
    function pushInit() {
        var ajpush = api.require('ajpush');
        ajpush.init(function(ret) {
            if (ret && ret.status) {
                //  Alert(ret);
            }
        });
        api.addEventListener({
            name: 'appintent'
        }, function(ret, err) {
            //  Alert('通知被点击，收到数据：\n' + JSON.stringify(ret)); //监听通知被点击后收到的数据
            var data = ret;
            setTimeout(function() {
                appintent(data);
            }, 1000);
        })
        api.addEventListener({
            name: 'resume'
        }, function(ret, err) {
            onResume(); //监听应用恢复到前台，通知jpush恢复事件
        })
        registration();
    }
    //统计-app恢复
    function onResume() {
        var ajpush = api.require('ajpush');
        ajpush.onResume();
        //    console.log('JPush onResume');
    }
    //通知被点击后收到的数据处理
    function appintent(data) {
        var pushdata = data.appParam.ajpush;
        //Alert(pushdata);
        var type = pushdata.extra.type
        if (type == 1) {
            var itemid = pushdata.extra.typeid;
            var couponid = pushdata.extra.couponid;
            pushXiangqing(itemid, couponid); //淘宝商品详情
        } else if (type == 2) {
            var huodongid = pushdata.extra.typeid;
            var title = pushdata.title;
            openHuodong(huodongid, title); //淘宝活动
        } else if (type == 3) {
            var title = pushdata.title;
            var url = pushdata.extra.url;
            if (pushdata.extra.typeid == 1) {
                loginopenwin(url, title);
            } else if (pushdata.extra.typeid == 2) {
                loginopen(url, title);
            } else {
                //未定义方法
            }
        } else if (type == 4) {
            update(); //下载升级APP
        }
    }

    function registration() {
        var ajpush = api.require('ajpush');
        var url = GetStorage('serverurl');
        var deviceName = api.deviceName;
        var deviceId = api.deviceId;
        var device = deviceName + '：' + deviceId
        ajpush.getRegistrationId(function(ret) {
            var registrationid = ret.id;
            //  console.log(registrationid);
            if (GetStorage('mobile')) {
                api.ajax({
                    url: url + '/api/user/registration?mobile=' + GetStorage('mobile') + '&registrationid=' + registrationid + '&deviceid=' + device,
                    method: 'get',
                }, function(ret, err) {
                    if (ret) {
                        console.warn(ret.msg);
                    }
                });
            }
        });
    }
</script>

</html>
